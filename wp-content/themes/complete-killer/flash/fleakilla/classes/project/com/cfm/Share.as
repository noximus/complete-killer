package com.cfm {	import flash.net.URLLoader;	import flash.display.Bitmap;	import flash.external.ExternalInterface;	import flash.net.navigateToURL;	import flash.net.URLRequest;	import flash.events.MouseEvent;	import flash.events.Event;	import flash.display.MovieClip;	import com.adobe.serialization.json.JSON;	public class Share extends MovieClip 	{		private var _model : AppModel;		public var facebook : MovieClip;		public var twitter : MovieClip;		public var email : MovieClip;		public var backButton : MovieClip;		public var backToVideo : MovieClip;		public var newVidButton : MovieClip;		public var poster : MovieClip;		public var emailForm : EmailFormPopup;				public function Share() : void		{			_model = AppModel.getInstance();			addEventListener(Event.ADDED_TO_STAGE, initialize, false, 0, true);		}		private function initialize(event : Event) : void		{			removeEventListener(Event.ADDED_TO_STAGE, initialize);						facebook.buttonMode = true;			facebook.addEventListener(MouseEvent.CLICK, facebookClickHandler, false, 0, true);			twitter.buttonMode = true;			twitter.addEventListener(MouseEvent.CLICK, twitterClickHandler, false, 0, true);			email.buttonMode = true;			email.addEventListener(MouseEvent.CLICK, emailClickHandler, false, 0, true);						newVidButton.buttonMode = true;			newVidButton.addEventListener(MouseEvent.CLICK, newVidClickHandler, false, 0, true);						if(_model.getStandAloneStatus())			{				backButton.visible = false;				backToVideo.buttonMode = true;				backToVideo.addEventListener(MouseEvent.CLICK, backToVideoClickHandler, false, 0, true);								poster.blankPoster.visible = true;			}			else			{				backToVideo.visible = false;				backButton.buttonMode = true;				backButton.addEventListener(MouseEvent.CLICK, backClickHandler, false, 0, true);				poster.blankPoster.visible = false;			}						if(_model.hasMoviePoster()) 			{				var bmp : Bitmap = _model.getMoviePoster();				bmp.smoothing = true;				bmp.x = -0.1;				bmp.y = -0.25;				bmp.width = 676.8;				bmp.height = 310.2;								poster.addChild(bmp);			}						emailForm = new EmailFormPopup();			emailForm.visible = false;			addChild(emailForm);		}				private function backClickHandler(event : MouseEvent) : void		{			_model.requestPage("assign");			_model.trackPage("ent/flea_killah/edit_preview");		}		private function backToVideoClickHandler(event : MouseEvent) : void		{			_model.requestPage("videoPreview");		}		private function newVidClickHandler(event : MouseEvent) : void		{			_model.reset();			_model.requestPage("intro");		}				private function facebookClickHandler(event : MouseEvent) : void		{			if(_model.getStandAloneStatus()) {				_model.trackPage("ent/flea_killah/watch/facebook_connect");							} else {				_model.trackPage("ent/flea_killah/share_facebook");			}						trace("Share: facebookClickHandler: _model.currentVideoID: ", _model.getShareID());			navigateToURL(new URLRequest("javascript:fb_relay_publish('" + _model.getShareID() + "')"),"_self");		}		private function twitterClickHandler(event : MouseEvent) : void		{						if(_model.getStandAloneStatus()) {								_model.trackPage("ent/flea_killah/watch/twitter");			} else {				_model.trackPage("ent/flea_killah/share_twitter");			}						trace("Share: twitterClickHandler: _model.getShareLink(): ", _model.getShareLink());						var login : String = "frontline";			var api : String = "R_620d942be2e1a8578e568950fa173209"			//"R_620d942be2e1a8578e568950fa173209";			//"0SqH32nSChO3MhUuqkFwTtqfmywncQHpqJk59j7VI			//"AgwFoQIrhAzEZCuc6L52TA			var longURL : String = escape(_model.getShareLink());			var bitlyRequest : String = "http://api.bit.ly/v3/shorten?login=" + login + "&apiKey=" + api + "&uri=" + longURL + "&format=txt";										var loader : URLLoader = new URLLoader();			loader.addEventListener(Event.COMPLETE,bitlyCompleteHandler);			loader.load(new URLRequest(bitlyRequest));								}				private function bitlyCompleteHandler(event:Event) : void		{			var shortLink : String = event.target.data;			if(shortLink != null && shortLink != "")			{				trace("Success! Short URL is : " + event.target.data);				var link = "http://twitter.com/home?status=From now on, call me \"The Slayer.\" Watch this video to find out why. " + event.target.data;				navigateToURL(new URLRequest(link),"_blank");			}		}		private function emailClickHandler(event : MouseEvent) : void		{			emailForm.show();						if(_model.getStandAloneStatus())			{								_model.trackPage("ent/flea_killah/watch/email");			}			else			{				_model.trackPage("ent/flea_killah/share_email");			}		}	}}