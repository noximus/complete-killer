package com.cfm{	import flash.display.*;	import flash.events.*;	import flash.errors.*;	import flash.net.*;	import flash.media.*;	import flash.external.*;	import flash.utils.*;	import flash.system.*;	import com.cfm.*;	import com.greensock.*;	import com.greensock.easing.*;	import br.com.stimuli.loading.loadingtypes.LoadingItem;	import br.com.stimuli.loading.BulkLoader;		public class FleaKilla extends MovieClip	{		private var _model:AppModel;		private var _shell:Sprite;		private var _initialView : MovieClip;		private var _loader : BulkLoader;		private var _imagesToLoad : Array = [];		private var _savePath : String;		public function FleaKilla():void		{			addEventListener(Event.ADDED_TO_STAGE,_initialize,false,0,true);		}				private function _initialize(event : Event):void		{			removeEventListener(Event.ADDED_TO_STAGE,_initialize);			_savePath = loaderInfo.parameters.savePath;						if(loaderInfo.parameters.standAlone != "true")			{				_createModel(false);				createFirstView(new Intro());				_initApp();			}			else			{				_createModel(true);				_loader = new BulkLoader("FleaKillah");				loadFlashVars(loaderInfo.parameters);			}		}				private function _createModel(isStandAlone:Boolean):void		{			_model = AppModel.getInstance();			_model.setStandAloneStatus(isStandAlone);			_model.setTrackingEnabled(true);			_model.setBasePath(loaderInfo.parameters.basepath);			_model.addEventListener("onPageChange",_swapPage,false,0,true);		}				public function loadFlashVars(params : Object) : void		{			trace("FleaKilla: loadFlashVars: params.position1: ", params.position1);			 			 if(params.shareID != null && params.shareID != "")			 {			 	_model.setShareID(params.shareID);			 }			 if(params.position1 != null && params.position1 != "")			 {			 	_imagesToLoad[0] = _savePath + params.position1;				 }			 if(params.position2 != null && params.position2 != "")			 {			 	_imagesToLoad[1] = _savePath + params.position2;				 }			 if(params.position3 != null && params.position3 != "")			 {			 	_imagesToLoad[2] = _savePath + params.position3;				 }			 if(params.position4 != null && params.position4 != "")			 {			 	_imagesToLoad[3] = _savePath + params.position4;				 }			 if(params.position5 != null && params.position5 != "")			 {			 	_imagesToLoad[4] = _savePath + params.position5;				 }			 trace("FleaKilla: loadFlashVars: _imagesToLoad: ", _imagesToLoad);			 			 _loader.addEventListener(BulkLoader.COMPLETE, loadCompleteHandler);			 var n:int = _imagesToLoad.length;			 for (var i:int = 0; i < n; i++)			 {			     if(_imagesToLoad[i] != null)			     {					var item : LoadingItem = _loader.add(_imagesToLoad[i]);					item.addEventListener(BulkLoader.COMPLETE, itemCompleteHandler);				 }			}			_loader.start();		}		private function itemCompleteHandler(event : Event) : void		{			var item : LoadingItem = LoadingItem(event.target);			trace("FleaKilla: itemCompleteHandler: item.id: ", item.url.url);			item.removeEventListener(BulkLoader.COMPLETE, itemCompleteHandler);			var bitmap : Bitmap = Bitmap(item.content);						_model.assignLoadedImage(bitmap, lookupIndex(item.url.url));		}				private function loadCompleteHandler(event : Event) : void		{			trace("FleaKillaPlayer: loadCompleteHandler");			_loader.removeEventListener(BulkLoader.COMPLETE, loadCompleteHandler);			createFirstView(new VideoPreview());			_initApp();		}				private function lookupIndex(url : String) : int		{			var n : int = _imagesToLoad.length;			for (var i:int = 0; i < n; i++)			{			 	trace("FleaKillaPlayer: lookupIndex: _imagesToLoad[i]: ", _imagesToLoad[i]);			 	if(_imagesToLoad[i] != null && _imagesToLoad[i] == url)				{			 		return i;   			 	}			}			return -1;		}				private function createFirstView(view : MovieClip) : void		{			_shell = new Sprite();			addChild(_shell);						_initialView = view;			_initialView.alpha = 0;			_shell.addChild(_initialView);		}		private function _initApp():void		{			_model.currPage = _initialView;			TweenMax.to(_initialView,1,{delay:1,alpha:1,ease:Sine.easeOut});		}				private function _swapPage(e:Event):void		{			trace("loading page");			TweenMax.to(_model.currPage,0.25,{alpha:0,ease:Sine.easeOut,onComplete:function(){				_model.currPage.x = stage.stageWidth;								while(_shell.numChildren > 1) _shell.removeChildAt(_shell.numChildren-1);				_model.nextPage.alpha = 0;				_shell.addChild(_model.nextPage);								TweenMax.to(_model.nextPage,0.5,{alpha:1,delay:0.25,ease:Sine.easeOut,onComplete:function(){					_model.currPage = _model.nextPage;					_model.nextPage = null;				}});			}});		}	}}